server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: pikabu-download-bot

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/pikabu_bot?currentSchema=pikabu_bot}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        default_schema: pikabu_bot

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.xml
    default-schema: pikabu_bot

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  prometheus:
    metrics:
      export:
        enabled: true

logging:
  level:
    root: ${LOGGING_LEVEL_ROOT:INFO}
    com.pikabu.bot: ${LOGGING_LEVEL_APP:INFO}
    com.pikabu.bot.service.parser: ${LOGGING_LEVEL_PARSER:DEBUG}
    com.pikabu.bot.service.download: ${LOGGING_LEVEL_DOWNLOAD:INFO}
    com.pikabu.bot.service.queue: ${LOGGING_LEVEL_QUEUE:INFO}
  file:
    name: ${LOGGING_FILE_PATH:./logs/pikabu-bot.log}
  logback:
    rollingpolicy:
      max-file-size: ${LOGGING_MAX_FILE_SIZE:100MB}
      max-history: ${LOGGING_MAX_HISTORY:30}
      total-size-cap: ${LOGGING_TOTAL_SIZE_CAP:3GB}
      file-name-pattern: ${LOGGING_FILE_PATH:./logs/pikabu-bot}-%d{yyyy-MM-dd}.%i.log
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} %5p %6r --- [%15.15t] %-40.40logger{39} : %m%n%wEx"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} %5p %6r --- [%15.15t] %-40.40logger{39} : %m%n%wEx"

telegram:
  bot:
    token: ${BOT_TOKEN}
    username: ${BOT_USERNAME}

pikabu:
  auth:
    enabled: ${PIKABU_AUTH_ENABLED:false}
    cookies: ${PIKABU_AUTH_COOKIES:}

app:
  admin:
    user-id: ${ADMIN_USER_ID}
    enable-notifications: ${ADMIN_ENABLE_NOTIFICATIONS:true}
    enable-daily-digest: ${ADMIN_ENABLE_DAILY_DIGEST:false}
  max-concurrent-downloads: ${APP_MAX_CONCURRENT_DOWNLOADS:5}
  rate-limit:
    max-requests: ${APP_RATE_LIMIT_MAX_REQUESTS:1000}
    window-hours: ${APP_RATE_LIMIT_WINDOW_HOURS:1}
  download:
    max-size-mb: 500
    timeout-minutes: 5
    external-timeout-minutes: ${APP_EXTERNAL_DOWNLOAD_TIMEOUT_MINUTES:20}
    max-retries: 3
  error-monitoring:
    parsing-error-threshold: 5
    parsing-error-window-minutes: 10
    download-error-threshold: 10
    download-error-window-minutes: 15
    check-interval-minutes: 5
